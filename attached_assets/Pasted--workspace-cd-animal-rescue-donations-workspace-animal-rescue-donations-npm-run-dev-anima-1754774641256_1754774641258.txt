~/workspace$ cd animal-rescue-donations
~/workspace/animal-rescue-donations$ npm run dev

> animal-rescue-donations@0.1.0 dev
> next dev

  â–² Next.js 14.2.28
  - Local:        http://localhost:3000
  - Environments: .env

 âœ“ Starting...
 âœ“ Ready in 5.5s
 â—‹ Compiling / ...
 âœ“ Compiled / in 12.6s (8586 modules)
 GET / 200 in 13272ms
 âœ“ Compiled in 1189ms (4186 modules)
 HEAD / 200 in 27ms
 â—‹ Compiling /api/chat ...
 âœ“ Compiled /api/chat in 1231ms (4637 modules)
[ğŸ§  AI Intent] AI detected general question, switching modes
[ğŸ§  Barkr] Final context: general
[ğŸ§  GPT Parser] No clear breed or location found in: hi barkr
[âš ï¸ Barkr] Invalid breed in memory, wiping: null
[âš ï¸ Barkr] Invalid location in memory, wiping: null
[ğŸ§  Final Decision] aiIntent: general, context: general, isAdoptionMode: false
 POST /api/chat 200 in 5701ms
[ğŸ§  AI Intent] AI detected adoption intent, staying in adoption mode
[ğŸ§  Barkr] Final context: adoption
[ğŸ”· Barkr] New breed provided, wiping previous: null
[ğŸ§  Final Decision] aiIntent: adoption, context: adoption, isAdoptionMode: true
[ğŸ§¼ Final Cleaned Location] Berwick, ME
[ğŸ“ Normalized Location] Berwick, ME
[ğŸ¾ Barkr Memory] {
  location: 'Berwick, ME',
  breed: 'chihuahuas',
  hasSeenResults: false,
  seenDogIds: [],
  cachedDogs: [],
  isAdoptionMode: true,
  isInvisibleDogsSearch: false
}
[ğŸ” Petfinder Params] { location: 'Berwick, ME', breed: 'chihuahuas' }
[ğŸ§  Breed Normalization] Input: chihuahuas â†’ Cleaned: Chihuahua
[âœ… Fallback Breed Match] "Chihuahua" â†’ "Chihuahua"
[âœ… Breed Match Success] Matched to: Chihuahua
[ğŸ—„ï¸ Database] Searching database first...
[ğŸ—„ï¸ Database] Filtering by breed: Chihuahua
[ğŸ—„ï¸ Database] Filtering by location: Berwick, ME
[ğŸ—„ï¸ Database] Filtering by state: ME
[ğŸ” Petfinder] Database returned only 0 dogs, searching Petfinder for additional...
 â—‹ Compiling /api/petfinder/search ...
 âœ“ Compiled /api/petfinder/search in 953ms (4643 modules)
[ğŸ” Enhanced Search] Starting priority waterfall search
[ğŸ“‹ Raw Input] {
  location: 'Berwick, ME',
  breed: 'Chihuahua',
  age: null,
  size: null,
  gender: null,
  limit: 25,
  isChat: true
}
[ğŸ¯ Context] Chat search - limit: 25
[ğŸ§¼ Normalized Params] { location: 'Berwick, ME', breed: 'Chihuahua', limit: 25, radius: 100 }
[ğŸ’¾ Database] Searching database first...
[ğŸ¦® RescueGroups] Searching RescueGroups...
[ğŸ—ºï¸ Geocoding] Converting "Berwick, ME" to coordinates for RescueGroups
[ğŸ“Š Geocoding] Making request 1754774625634
[ğŸ—ºï¸ Geocoding] Response status: 200
[ğŸ—ºï¸ Geocoding] Full response: {
  "type": "FeatureCollection",
  "query": [
    "berwick",
    "me"
  ],
  "features": [
    {
      "id": "place.26536172",
      "type": "Feature",
      "place_type": [
        "place"
      ],
      "relevance": 1,
      "properties": {
        "mapbox_id": "dXJuOm1ieHBsYzpBWlRvN0E",
        "wikidata": "Q3451686"
      },
      "text": "Berwick",
      "place_name": "Berwick, Maine, United States",
      "bbox": [
        -70.946529,
        43.237651,
        -70.760399,
        43.366776
      ],
      "center": [
        -70.864231,
        43.265882
      ],
      "geometry": {
        "type": "Point",
        "coordinates": [
          -70.864231,
          43.265882
        ]
      },
      "context": [
        {
          "id": "district.25675500",
          "mapbox_id": "dXJuOm1ieHBsYzpBWWZHN0E",
          "wikidata": "Q390141",
          "text": "York County"
        },
        {
          "id": "region.337132",
          "mapbox_id": "dXJuOm1ieHBsYzpCU1Rz",
          "wikidata": "Q724",
          "short_code": "US-ME",
          "text": "Maine"
        },
        {
          "id": "country.8940",
          "mapbox_id": "dXJuOm1ieHBsYzpJdXc",
          "wikidata": "Q30",
          "short_code": "us",
          "text": "United States"
        }
      ]
    }
  ],
  "attribution": "NOTICE: Â© 2025 Mapbox and its suppliers. All rights reserved. Use of this data is subject to the Mapbox Terms of Service (https://www.mapbox.com/about/maps/). This response and the information it contains may not be retained."
}
[âœ… Geocoded] "Berwick, ME" â†’ 43.265882, -70.864231
[ğŸ“ Location Details] Berwick, Maine, United States
[ğŸ“ Final Coordinates] Will search RescueGroups with: 43.265882, -70.864231
[ğŸ¦® RescueGroups] Starting smart fallback search with params: {
  location: 'Berwick, ME',
  breed: 'Chihuahua',
  age: undefined,
  size: undefined,
  gender: undefined,
  limit: 25,
  radius: 100,
  latitude: 43.265882,
  longitude: -70.864231
}
[ğŸ¯ RescueGroups] Attempt 1: Full filters
[ğŸ—ºï¸ RescueGroups] Using coordinates: 43.265882, -70.864231 with radius 100mi
[ğŸ” RescueGroups] Applying breed filter: Chihuahua (from: chihuahua)
[ğŸ¦® RescueGroups] Search URL: https://api.rescuegroups.org/v5/public/animals/search/available/dogs?filter%5Bspecies%5D=dog&filter%5Bupdated%5D=%3E2025-05-09&filter%5Blocation.latitude%5D=43.265882&filter%5Blocation.longitude%5D=-70.864231&filter%5Blocation.distance%5D=100&filter%5Blatitude%5D=43.265882&filter%5Blongitude%5D=-70.864231&filter%5Bdistance%5D=100&filter%5BbreedPrimary%5D=Chihuahua&filter%5BanimalBreed%5D=Chihuahua&limit=25&fields%5Banimals%5D=id%2Cname%2Cstatus%2Cspecies%2CageGroup%2Csex%2CsizeGroup%2CbreedPrimary%2CbreedSecondary%2CbreedMixed%2CdescriptionText%2CspecialNeeds%2ChouseTrained%2CgoodWithChildren%2CgoodWithCats%2CgoodWithDogs%2Cpictures%2CthumbnailUrl%2Curl%2Cdistance%2Cupdated%2Ccreated%2CanimalLocationCity%2CanimalLocationState%2CanimalLocationPostalcode&include=orgs%2Clocations%2Cbreeds%2Cpictures
[ğŸ¦® RescueGroups] Making GET request to: https://api.rescuegroups.org/v5/public/animals/search/available/dogs?filter%5Bspecies%5D=dog&filter%5Bupdated%5D=%3E2025-05-09&filter%5Blocation.latitude%5D=43.265882&filter%5Blocation.longitude%5D=-70.864231&filter%5Blocation.distance%5D=100&filter%5Blatitude%5D=43.265882&filter%5Blongitude%5D=-70.864231&filter%5Bdistance%5D=100&filter%5BbreedPrimary%5D=Chihuahua&filter%5BanimalBreed%5D=Chihuahua&limit=25&fields%5Banimals%5D=id%2Cname%2Cstatus%2Cspecies%2CageGroup%2Csex%2CsizeGroup%2CbreedPrimary%2CbreedSecondary%2CbreedMixed%2CdescriptionText%2CspecialNeeds%2ChouseTrained%2CgoodWithChildren%2CgoodWithCats%2CgoodWithDogs%2Cpictures%2CthumbnailUrl%2Curl%2Cdistance%2Cupdated%2Ccreated%2CanimalLocationCity%2CanimalLocationState%2CanimalLocationPostalcode&include=orgs%2Clocations%2Cbreeds%2Cpictures
[ğŸ¦® RescueGroups] Response status: 200
[ğŸ¦® RescueGroups] Response result structure: {
  dataCount: 25,
  includedCount: 253,
  meta: {
    count: 37463,
    countReturned: 25,
    pageReturned: 1,
    limit: 25,
    pages: 1499,
    transactionId: 'PlZGHBMeqOUa'
  }
}
[ğŸ“Š RescueGroups] Found 25 animals
[ğŸ—ºï¸ RescueGroups] Geographic filtering: 25 â†’ 0 relevant results
[âš ï¸ RescueGroups] Too many irrelevant results (0/25) - treating as failed search
[ğŸ¯ RescueGroups] Attempt 2: Removing strict breed filter "Chihuahua"
[ğŸ—ºï¸ RescueGroups] Using coordinates: 43.265882, -70.864231 with radius 100mi
[ğŸ¦® RescueGroups] Search URL: https://api.rescuegroups.org/v5/public/animals/search/available/dogs?filter%5Bspecies%5D=dog&filter%5Bupdated%5D=%3E2025-05-09&filter%5Blocation.latitude%5D=43.265882&filter%5Blocation.longitude%5D=-70.864231&filter%5Blocation.distance%5D=100&filter%5Blatitude%5D=43.265882&filter%5Blongitude%5D=-70.864231&filter%5Bdistance%5D=100&limit=25&fields%5Banimals%5D=id%2Cname%2Cstatus%2Cspecies%2CageGroup%2Csex%2CsizeGroup%2CbreedPrimary%2CbreedSecondary%2CbreedMixed%2CdescriptionText%2CspecialNeeds%2ChouseTrained%2CgoodWithChildren%2CgoodWithCats%2CgoodWithDogs%2Cpictures%2CthumbnailUrl%2Curl%2Cdistance%2Cupdated%2Ccreated%2CanimalLocationCity%2CanimalLocationState%2CanimalLocationPostalcode&include=orgs%2Clocations%2Cbreeds%2Cpictures
[ğŸ¦® RescueGroups] Making GET request to: https://api.rescuegroups.org/v5/public/animals/search/available/dogs?filter%5Bspecies%5D=dog&filter%5Bupdated%5D=%3E2025-05-09&filter%5Blocation.latitude%5D=43.265882&filter%5Blocation.longitude%5D=-70.864231&filter%5Blocation.distance%5D=100&filter%5Blatitude%5D=43.265882&filter%5Blongitude%5D=-70.864231&filter%5Bdistance%5D=100&limit=25&fields%5Banimals%5D=id%2Cname%2Cstatus%2Cspecies%2CageGroup%2Csex%2CsizeGroup%2CbreedPrimary%2CbreedSecondary%2CbreedMixed%2CdescriptionText%2CspecialNeeds%2ChouseTrained%2CgoodWithChildren%2CgoodWithCats%2CgoodWithDogs%2Cpictures%2CthumbnailUrl%2Curl%2Cdistance%2Cupdated%2Ccreated%2CanimalLocationCity%2CanimalLocationState%2CanimalLocationPostalcode&include=orgs%2Clocations%2Cbreeds%2Cpictures
[ğŸ¦® RescueGroups] Response status: 200
[ğŸ¦® RescueGroups] Response result structure: {
  dataCount: 25,
  includedCount: 253,
  meta: {
    count: 37463,
    countReturned: 25,
    pageReturned: 1,
    limit: 25,
    pages: 1499,
    transactionId: 'PIXcNJoIvlsi'
  }
}
[ğŸ“Š RescueGroups] Found 25 animals
[ğŸ—ºï¸ RescueGroups] Geographic filtering: 25 â†’ 0 relevant results
[âš ï¸ RescueGroups] Too many irrelevant results (0/25) - treating as failed search
[ğŸ¯ RescueGroups] Attempt 3: Expanding radius to 250 miles
[ğŸ—ºï¸ RescueGroups] Using coordinates: 43.265882, -70.864231 with radius 250mi
[ğŸ¦® RescueGroups] Search URL: https://api.rescuegroups.org/v5/public/animals/search/available/dogs?filter%5Bspecies%5D=dog&filter%5Bupdated%5D=%3E2025-05-09&filter%5Blocation.latitude%5D=43.265882&filter%5Blocation.longitude%5D=-70.864231&filter%5Blocation.distance%5D=250&filter%5Blatitude%5D=43.265882&filter%5Blongitude%5D=-70.864231&filter%5Bdistance%5D=250&limit=25&fields%5Banimals%5D=id%2Cname%2Cstatus%2Cspecies%2CageGroup%2Csex%2CsizeGroup%2CbreedPrimary%2CbreedSecondary%2CbreedMixed%2CdescriptionText%2CspecialNeeds%2ChouseTrained%2CgoodWithChildren%2CgoodWithCats%2CgoodWithDogs%2Cpictures%2CthumbnailUrl%2Curl%2Cdistance%2Cupdated%2Ccreated%2CanimalLocationCity%2CanimalLocationState%2CanimalLocationPostalcode&include=orgs%2Clocations%2Cbreeds%2Cpictures
[ğŸ¦® RescueGroups] Making GET request to: https://api.rescuegroups.org/v5/public/animals/search/available/dogs?filter%5Bspecies%5D=dog&filter%5Bupdated%5D=%3E2025-05-09&filter%5Blocation.latitude%5D=43.265882&filter%5Blocation.longitude%5D=-70.864231&filter%5Blocation.distance%5D=250&filter%5Blatitude%5D=43.265882&filter%5Blongitude%5D=-70.864231&filter%5Bdistance%5D=250&limit=25&fields%5Banimals%5D=id%2Cname%2Cstatus%2Cspecies%2CageGroup%2Csex%2CsizeGroup%2CbreedPrimary%2CbreedSecondary%2CbreedMixed%2CdescriptionText%2CspecialNeeds%2ChouseTrained%2CgoodWithChildren%2CgoodWithCats%2CgoodWithDogs%2Cpictures%2CthumbnailUrl%2Curl%2Cdistance%2Cupdated%2Ccreated%2CanimalLocationCity%2CanimalLocationState%2CanimalLocationPostalcode&include=orgs%2Clocations%2Cbreeds%2Cpictures
[ğŸ¦® RescueGroups] Response status: 200
[ğŸ¦® RescueGroups] Response result structure: {
  dataCount: 25,
  includedCount: 253,
  meta: {
    count: 37463,
    countReturned: 25,
    pageReturned: 1,
    limit: 25,
    pages: 1499,
    transactionId: 'qOtZSOfuqImt'
  }
}
[ğŸ“Š RescueGroups] Found 25 animals
[ğŸ—ºï¸ RescueGroups] Geographic filtering: 25 â†’ 2 relevant results
[âš ï¸ RescueGroups] Too many irrelevant results (2/25) - treating as failed search
[ğŸ¯ RescueGroups] Attempt 4: Location-only search (removing all non-location filters)
[ğŸ—ºï¸ RescueGroups] Using coordinates: 43.265882, -70.864231 with radius 250mi
[ğŸ¦® RescueGroups] Search URL: https://api.rescuegroups.org/v5/public/animals/search/available/dogs?filter%5Bspecies%5D=dog&filter%5Bupdated%5D=%3E2025-05-09&filter%5Blocation.latitude%5D=43.265882&filter%5Blocation.longitude%5D=-70.864231&filter%5Blocation.distance%5D=250&filter%5Blatitude%5D=43.265882&filter%5Blongitude%5D=-70.864231&filter%5Bdistance%5D=250&limit=25&fields%5Banimals%5D=id%2Cname%2Cstatus%2Cspecies%2CageGroup%2Csex%2CsizeGroup%2CbreedPrimary%2CbreedSecondary%2CbreedMixed%2CdescriptionText%2CspecialNeeds%2ChouseTrained%2CgoodWithChildren%2CgoodWithCats%2CgoodWithDogs%2Cpictures%2CthumbnailUrl%2Curl%2Cdistance%2Cupdated%2Ccreated%2CanimalLocationCity%2CanimalLocationState%2CanimalLocationPostalcode&include=orgs%2Clocations%2Cbreeds%2Cpictures
[ğŸ¦® RescueGroups] Making GET request to: https://api.rescuegroups.org/v5/public/animals/search/available/dogs?filter%5Bspecies%5D=dog&filter%5Bupdated%5D=%3E2025-05-09&filter%5Blocation.latitude%5D=43.265882&filter%5Blocation.longitude%5D=-70.864231&filter%5Blocation.distance%5D=250&filter%5Blatitude%5D=43.265882&filter%5Blongitude%5D=-70.864231&filter%5Bdistance%5D=250&limit=25&fields%5Banimals%5D=id%2Cname%2Cstatus%2Cspecies%2CageGroup%2Csex%2CsizeGroup%2CbreedPrimary%2CbreedSecondary%2CbreedMixed%2CdescriptionText%2CspecialNeeds%2ChouseTrained%2CgoodWithChildren%2CgoodWithCats%2CgoodWithDogs%2Cpictures%2CthumbnailUrl%2Curl%2Cdistance%2Cupdated%2Ccreated%2CanimalLocationCity%2CanimalLocationState%2CanimalLocationPostalcode&include=orgs%2Clocations%2Cbreeds%2Cpictures
[ğŸ¦® RescueGroups] Response status: 200
[ğŸ¦® RescueGroups] Response result structure: {
  dataCount: 25,
  includedCount: 253,
  meta: {
    count: 37463,
    countReturned: 25,
    pageReturned: 1,
    limit: 25,
    pages: 1499,
    transactionId: 'AyLaqFVOlHXx'
  }
}
[ğŸ“Š RescueGroups] Found 25 animals
[ğŸ—ºï¸ RescueGroups] Geographic filtering: 25 â†’ 2 relevant results
[âš ï¸ RescueGroups] Too many irrelevant results (2/25) - treating as failed search
[âŒ RescueGroups] All attempts failed - returning empty results to trigger Petfinder fallback
[ğŸ¾ Petfinder] Falling back to Petfinder API...
[ğŸ“Š Current Results] 0 dogs found so far, need 25 more
[ğŸ”„ Rate Limit] Reset rate limit window
[ğŸ« Token Manager] Fetching new Petfinder access token...
[âœ… Token Manager] Got new Petfinder token, expires in 3600 seconds
[âœ… Fallback Breed Match] "Chihuahua" â†’ "Chihuahua"
[ğŸ“¡ Petfinder] Fetching: https://api.petfinder.com/v2/animals?type=dog&status=adoptable&limit=25&location=Berwick%2C+ME&distance=100&breed=Chihuahua
[âœ… Petfinder Hit] Found 25 dogs from Petfinder
[ğŸ”„ Deduplication] 0 duplicates removed from Petfinder
[âœ… Search Complete] Found 25 total dogs from sources: petfinder
[ğŸ“Š Source Breakdown] petfinder: 25
 POST /api/petfinder/search 200 in 5237ms
[âœ… Chat Search Success] Found 25 dogs for chihuahuas in Berwick, ME from sources: petfinder
[âœ… Petfinder Integration] Found 25 Petfinder dogs, 0 were duplicates of database dogs
[âœ… Search Complete] Total unique dogs: 25 Showing: 10
[âœ… Search Complete] Total unique dogs: 25 Showing: 10
[ğŸ“Š Scores] Sample scores: [
  'Eli: 86',
  'Goomba: 86',
  'Missy in NH! Come Meet our Adoptable Dogs Wednesday-Saturday. More info in Bio!: 60'
]
 POST /api/chat 200 in 7565ms